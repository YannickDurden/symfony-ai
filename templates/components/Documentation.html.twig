<div{{attributes.defaults({class:'search-documentation-component'})}}>
	<div class="search-form">
		<div class="form-group">
			<label for="query">Rechercher dans la documentation</label>
			<input type="text" id="query" data-model="query" value="{{ query }}" placeholder="Ex: Comment configurer le bundle ? Installation du module..." class="form-control{% if _errors.has('query') %} is-invalid{% endif %}" {% if isLoading %} disabled {% endif %}>
			{% if _errors.has('query') %}
				<div class="invalid-feedback">
					{{ _errors.get('query') }}
				</div>
			{% endif %}
		</div>

		<div class="form-actions">
			<button type="button" class="btn btn-primary" data-action="live#action" data-live-action-param="search" {% if isLoading or query == '' %} disabled {% endif %}>
				{% if isLoading %}
					<span class="spinner"></span>
					Recherche en cours...
				{% else %}
					üìö Rechercher
				{% endif %}
			</button>

			{% if hasSearched or query != '' %}
				<button type="button" class="btn btn-secondary" data-action="live#action" data-live-action-param="reset" {% if isLoading %} disabled {% endif %}>
					‚Üª Nouvelle recherche
				</button>
			{% endif %}
		</div>
	</div>

	{% if hasSearched and synthesis != '' %}
		<div class="synthesis-section">
			<div class="synthesis-header">
				<h3>ü§ñ R√©ponse synth√©tis√©e</h3>
			</div>
			<div class="synthesis-content">
				{{ synthesis|markdown_to_html|raw }}
			</div>
		</div>
	{% endif %}
	{% if hasSearched and results|length > 0 %}
		<div class="sources-section">
			<div class="sources-header">
				<h3>üìö Sources de la documentation ({{ results|length }}
					r√©sultat{{ results|length > 1 ? 's' : '' }})</h3>
			</div>
			<div
				class="documentation-grid">{# Cartes existantes #}
			</div>
		</div>
	{% endif %}

	{% if hasSearched %}
		<div class="search-results">
			{% if results|length > 0 %}
				<div class="results-header">
					<h3>üìñ
						{{ results|length }}
						r√©sultat{{ results|length > 1 ? 's' : '' }}
						trouv√©{{ results|length > 1 ? 's' : '' }}</h3>
				</div>

				<div class="documentation-grid">
					{% for doc in results %}
						<div class="doc-card">
							<div class="doc-header">
								<span class="bundle-badge">üì¶
									{{ doc.bundleName }}</span>
								<span class="version-badge">v{{ doc.bundleVersion }}</span>
							</div>

							<h3 class="doc-title">{{ doc.sectionTitle }}</h3>

							<div class="doc-content">
								{{ doc.content|slice(0, 350) }}{{ doc.content|length > 350 ? '...' : '' }}
							</div>

							<div class="doc-footer">
								<span class="doc-path" title="{{ doc.filePath }}">
									üìç
									{{ doc.filePath|split('/')|last }}
								</span>
								{% if doc.repositoryUrl %}
									<a href="{{ doc.repositoryUrl }}" target="_blank" class="doc-link" rel="noopener noreferrer">
										üîó Voir la source
									</a>
								{% endif %}
							</div>
						</div>
					{% endfor %}
				</div>
			{% else %}
				<div class="no-results">
					<div class="no-results-icon">üîç</div>
					<h3>Aucun r√©sultat trouv√©</h3>
					<p>Essayez avec d'autres mots-cl√©s ou reformulez votre question</p>
				</div>
			{% endif %}
		</div>
	{% endif %}


	<style>
		.search-documentation-component {
			max-width: 1200px;
			margin: 0 auto;
			padding: 20px;
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
		}

		.search-form {
			background: white;
			padding: 24px;
			border-radius: 12px;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
			margin-bottom: 30px;
		}

		.form-group {
			margin-bottom: 20px;
		}

		.form-group label {
			display: block;
			margin-bottom: 8px;
			font-weight: 600;
			color: #262626;
			font-size: 16px;
		}

		.form-control {
			width: 100%;
			padding: 14px 16px;
			border: 1px solid #dbdbdb;
			border-radius: 8px;
			font-size: 15px;
			transition: all 0.2s;
			box-sizing: border-box;
		}

		.form-control:focus {
			outline: none;
			border-color: #0095f6;
			box-shadow: 0 0 0 3px rgba(0, 149, 246, 0.1);
		}

		.form-control.is-invalid {
			border-color: #ed4956;
		}

		.invalid-feedback {
			color: #ed4956;
			font-size: 13px;
			margin-top: 6px;
		}

		.form-actions {
			display: flex;
			gap: 12px;
			align-items: center;
		}

		.btn {
			padding: 12px 24px;
			border: none;
			border-radius: 8px;
			font-size: 15px;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.2s;
			display: inline-flex;
			align-items: center;
			gap: 8px;
		}

		.btn:disabled {
			opacity: 0.5;
			cursor: not-allowed;
		}

		.btn-primary {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
		}

		.btn-primary:hover:not(:disabled) {
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
		}

		.btn-secondary {
			background-color: #fafafa;
			color: #262626;
			border: 1px solid #dbdbdb;
		}

		.btn-secondary:hover:not(:disabled) {
			background-color: #f0f0f0;
		}

		.spinner {
			width: 16px;
			height: 16px;
			border: 2px solid rgba(255, 255, 255, 0.3);
			border-top-color: white;
			border-radius: 50%;
			animation: spin 0.8s linear infinite;
		}

		@keyframes spin {
			to {
				transform: rotate(360deg);
			}
		}

		.search-results {
			animation: fadeIn 0.3s ease-in;
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: translateY(10px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.results-header {
			margin-bottom: 24px;
		}

		.results-header h3 {
			color: #262626;
			font-size: 18px;
			font-weight: 600;
			margin: 0;
		}

		.documentation-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
			gap: 20px;
		}

		@media(max-width: 768px) {
			.documentation-grid {
				grid-template-columns: 1fr;
				gap: 16px;
			}
		}

		.doc-card {
			background: white;
			border-radius: 12px;
			padding: 20px;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
			transition: all 0.3s ease;
			display: flex;
			flex-direction: column;
			gap: 12px;
		}

		.doc-card:hover {
			transform: translateY(-4px);
			box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
		}

		.doc-header {
			display: flex;
			gap: 8px;
			align-items: center;
			flex-wrap: wrap;
		}

		.bundle-badge {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			padding: 6px 12px;
			border-radius: 6px;
			font-size: 13px;
			font-weight: 600;
			display: inline-flex;
			align-items: center;
			gap: 4px;
		}

		.version-badge {
			background-color: #f0f0f0;
			color: #666;
			padding: 6px 10px;
			border-radius: 6px;
			font-size: 12px;
			font-weight: 600;
			font-family: 'Courier New', monospace;
		}

		.doc-title {
			color: #262626;
			font-size: 18px;
			font-weight: 700;
			margin: 0;
			line-height: 1.4;
		}

		.doc-content {
			color: #555;
			font-size: 14px;
			line-height: 1.6;
			flex-grow: 1;
			overflow: hidden;
			display: -webkit-box;
			-webkit-line-clamp: 5;
			-webkit-box-orient: vertical;
		}

		.doc-footer {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding-top: 12px;
			border-top: 1px solid #f0f0f0;
			gap: 12px;
			flex-wrap: wrap;
		}

		.doc-path {
			color: #8e8e8e;
			font-size: 13px;
			display: inline-flex;
			align-items: center;
			gap: 4px;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			flex: 1;
			min-width: 0;
		}

		.doc-link {
			color: #667eea;
			text-decoration: none;
			font-size: 13px;
			font-weight: 600;
			display: inline-flex;
			align-items: center;
			gap: 4px;
			transition: all 0.2s;
			white-space: nowrap;
		}

		.doc-link:hover {
			color: #764ba2;
			transform: translateX(2px);
		}

		/* No results */
		.no-results {
			text-align: center;
			padding: 60px 20px;
			background: white;
			border-radius: 12px;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
		}

		.no-results-icon {
			font-size: 64px;
			margin-bottom: 16px;
			opacity: 0.5;
		}

		.no-results h3 {
			color: #262626;
			font-size: 20px;
			font-weight: 600;
			margin: 0 0 8px;
		}

		.no-results p {
			color: #8e8e8e;
			font-size: 15px;
			margin: 0;
		}
		.synthesis-section {
			background: white;
			border-radius: 12px;
			padding: 24px;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
			margin-bottom: 30px;
			animation: fadeIn 0.3s ease-in;
		}
		.synthesis-header {
			margin-bottom: 16px;
			padding-bottom: 12px;
			border-bottom: 2px solid #667eea;
		}
		.synthesis-header h3 {
			color: #262626;
			font-size: 20px;
			font-weight: 700;
			margin: 0;
			display: flex;
			align-items: center;
			gap: 8px;
		}
		.synthesis-content {
			color: #333;
			font-size: 15px;
			line-height: 1.8;
		}
		.synthesis-content h2 {
			color: #667eea;
			font-size: 18px;
			font-weight: 700;
			margin: 20px 0 12px;
		}
		.synthesis-content h3 {
			color: #764ba2;
			font-size: 16px;
			font-weight: 600;
			margin: 16px 0 10px;
		}
		.synthesis-content ul {
			margin: 12px 0;
			padding-left: 24px;
		}
		.synthesis-content li {
			margin: 6px 0;
		}
		.synthesis-content code {
			background: #f5f5f5;
			padding: 2px 6px;
			border-radius: 4px;
			font-family: 'Courier New', monospace;
			font-size: 14px;
			color: #667eea;
		}
		.sources-section {
			margin-top: 30px;
		}
		.sources-header {
			margin-bottom: 20px;
		}
		.sources-header h3 {
			color: #8e8e8e;
			font-size: 16px;
			font-weight: 600;
			margin: 0;
		}
	</style>
</div>
